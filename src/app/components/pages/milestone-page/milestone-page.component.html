<app-loading *ngIf="loading"></app-loading>

<div class="section">
  <a [routerLink]="[ '/', org, repo ]" class="waves-effect waves-light btn-small"><i class="material-icons left">arrow_back</i>Go back</a>
</div>

<div class="section">
  <h4>{{ sprint?.title }}</h4>
  <h6><strong> Start Date:</strong> {{ sprint?.dates.start_date | date}}  | <strong>End Date:</strong>  {{ sprint?.dates.end_date | date}}</h6>
  <div class="milestoneDescription card-panel topIndicator">
    <div class="buttonsMilestone right">
      <a class="btn-floating btn-small  " href="{{ sprint?.repository.html_url }}/milestones/{{ sprint?.number }}/edit" target="_blank">
        <i class="material-icons">edit</i>
      </a>
    </div>
    <p [innerHTML]="sprint?.description | nl2br"></p>
  </div>
</div>

<div class="section">
  <h5> Tickets ({{ tickets.length }})</h5>
  <table id="issuesList" class="table table-striped table-bordered" style="width:100%">
    <thead>
      <tr>
        <th>ID</th>
        <th>Subject</th>
        <th>Type</th>
        <th>Priority</th>
        <th>Status</th>
        <th>Agent</th>
        <th>Created At</th>
        <th>Updated At</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let ticket of tickets">
        <td class="text-center"> <a href="https://marlo.freshdesk.com/a/tickets/{{ ticket.id}}">{{ ticket.id }} </a> </td>
        <td>{{ ticket.subject }}</td>
        <td>{{ ticket.type }}</td>
        <td>{{ ticket.priorityName }}</td>
        <td>{{ ticket.statusName }}</td>
        <td>{{ ticket.responderInfo.contact.name }}</td>
        <td>{{ ticket.created_at }}</td>
        <td>{{ ticket.updated_at }}</td>
      </tr>
    </tbody>
  </table>
</div>

<div class="section">
  <h5> Issues ({{ issues.length }})</h5>
  <table id="issuesList" class="table table-striped table-bordered striped" style="width:100%">
    <thead>
      <tr>
        <th>Title</th>
        <th>Type</th>
        <th>Priority</th>
        <th>Responsible</th>
        <th>Responsible(s)</th>
        <th>Estimate <br><small>ZenHub</small></th>
        <th>Pipeline <br><small>ZenHub</small></th>
        <th>Created At</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let issue of issues" class="pipeline-{{ (issue.zenhub.pipeline.name).replace(' ', '-') }}">
        <td>
          <div class="right">
            <span *ngIf="issue.pull_request" class="new badge" data-badge-caption="Pull Request"></span>
            <span *ngIf="issue.isNew" class="new badge" data-badge-caption="New"></span>
          </div>
          <span class="title"> <a href="{{ issue.html_url}}">#{{ issue.number }} </a>  {{ issue.title }} </span>
        </td>
        <td class="center-align"> {{ issue.type }} </td>
        <td class="center-align"> {{ issue.priority }} </td>
        <td class="">
          <div class="chip amber lighten-4">
            <img src="{{ issue.assignee.avatar_url}}" alt="{{ issue.assignee.login }}"> {{ issue.assignee.acronym }}
          </div>
        </td>
        <td>
          <div>
            <div *ngFor="let user of issue.assignees">
              <div *ngIf="!(user.login == issue.assignee.login)" class="chip">
                <img src="{{ user.avatar_url}}" alt="{{ user.login }}"> {{ user.acronym }}
              </div>
            </div>
          </div>
        </td>
        <td class="center-align"> {{ (issue.zenhub.estimate.value || 0) }} </td>
        <td class="center-align pipelineColumn"> {{ issue.zenhub.pipeline.name }} </td>
        <td> <small>{{ issue.created_at }}</small> </td>
      </tr>
    </tbody>
  </table>
</div>
